<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Cosine similarity · LSHFunctions.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">LSHFunctions.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../lshfunction_api/">The LSHFunction API</a></li><li><span class="tocitem">Similarity statistics</span><ul><li class="is-active"><a class="tocitem" href>Cosine similarity</a><ul class="internal"><li><a class="tocitem" href="#Definition"><span>Definition</span></a></li><li><a class="tocitem" href="#SimHash"><span>SimHash</span></a></li></ul></li><li><a class="tocitem" href="../lp_distance/"><span>$\ell^p$</span> distance</a></li><li><a class="tocitem" href="../jaccard/">Jaccard similarity</a></li><li><a class="tocitem" href="../inner_prod/">Inner product similarity</a></li></ul></li><li><a class="tocitem" href="../../function_hashing/">Function-space hashing</a></li><li><a class="tocitem" href="../../performance/">Performance tips</a></li><li><a class="tocitem" href="../../faq/">FAQ</a></li><li><a class="tocitem" href="../../glossary/">Glossary</a></li><li><a class="tocitem" href="../../full_api/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Similarity statistics</a></li><li class="is-active"><a href>Cosine similarity</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Cosine similarity</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/kernelmethod/LSHFunctions.jl/blob/master/docs/src/similarities/cosine.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Cosine-similarity"><a class="docs-heading-anchor" href="#Cosine-similarity">Cosine similarity</a><a id="Cosine-similarity-1"></a><a class="docs-heading-anchor-permalink" href="#Cosine-similarity" title="Permalink"></a></h1><div class="admonition is-warning"><header class="admonition-header">Under construction</header><div class="admonition-body"><p>This section is currently being developed. If you&#39;re interested in helping write this section, feel free to <a href="https://github.com/kernelmethod/LSHFunctions.jl/pulls">open a pull request</a>; otherwise, please check back later.</p></div></div><h2 id="Definition"><a class="docs-heading-anchor" href="#Definition">Definition</a><a id="Definition-1"></a><a class="docs-heading-anchor-permalink" href="#Definition" title="Permalink"></a></h2><p><a href="https://en.wikipedia.org/wiki/Cosine_similarity">Cosine similarity</a>, roughly speaking, measures the angle between a pair of inputs. Two inputs are very similar if the angle between them is low, and their similarity drops as the angle between them increases.</p><p>Concretely, cosine similarity is computed as</p><p class="math-container">\[\text{cossim}(x,y) = \frac{\left\langle x,y\right\rangle}{\|x\|\cdot\|y\|} = \left\langle\frac{x}{\|x\|},\frac{y}{\|y\|}\right\rangle\]</p><p>where <span>$\left\langle\cdot,\cdot\right\rangle$</span> is an inner product (e.g., dot product) and <span>$\|\cdot\|$</span> is the norm derived from that inner product. <span>$\text{cossim}(x,y)$</span> goes from <span>$-1$</span> to <span>$1$</span>, where <span>$-1$</span> corresponds to low similarity and <span>$1$</span> corresponds to high similarity. To calculate cosine similarity, you can use the <a href="../../full_api/#LSHFunctions.cossim-Tuple{AbstractArray{T,1} where T,AbstractArray{T,1} where T}"><code>cossim</code></a> function exported from the <code>LSH</code> module:</p><pre><code class="language-julia-repl">julia&gt; using LSHFunctions, LinearAlgebra

julia&gt; x = [5, 3, -1, 1];  # norm(x) == 6

julia&gt; y = [2, -2, -2, 2]; # norm(y) == 4

julia&gt; cossim(x,y) == dot(x,y) / (norm(x)*norm(y))
true

julia&gt; cossim(x,y) == (5*2 + 3*(-2) + (-1)*(-2) + 1*2) / (6*4)
true</code></pre><h2 id="SimHash"><a class="docs-heading-anchor" href="#SimHash">SimHash</a><a id="SimHash-1"></a><a class="docs-heading-anchor-permalink" href="#SimHash" title="Permalink"></a></h2><p><em>SimHash</em><sup class="footnote-reference"><a id="citeref-1" href="#footnote-1">[1]</a></sup><sup class="footnote-reference"><a id="citeref-Charikar02" href="#footnote-Charikar02">[Charikar02]</a></sup> is a family of LSH functions for hashing with respect to cosine similarity. You can generate a new hash function from this family by calling <a href="../../full_api/#LSHFunctions.SimHash"><code>SimHash</code></a>:</p><pre><code class="language-julia-repl">julia&gt; hashfn = SimHash();

julia&gt; n_hashes(hashfn)
1

julia&gt; hashfn = SimHash(40);

julia&gt; n_hashes(hashfn)
40</code></pre><p>Once constructed, you can start hashing vectors by calling <code>hashfn(x)</code>:</p><pre><code class="language-julia">hashfn = SimHash(100)

# x and y have high cosine similarity since they point in the same direction
# x and z have low cosine similarity since they point in opposite directions
x = randn(128)
y = 2x
z = -x

hx, hy, hz = hashfn(x), hashfn(y), hashfn(z)

# Among the 100 hash functions that we generated, we expect more hash
# collisions between x and y than between x and z
sum(hx .== hy) &gt; sum(hx .== hz)</code></pre><p>Note that <a href="../../full_api/#LSHFunctions.SimHash"><code>SimHash</code></a> is a one-bit hash function. As a result, <code>hashfn(x)</code> returns a <code>BitArray</code>:</p><pre><code class="language-julia-repl">julia&gt; hashfn = SimHash();

julia&gt; n_hashes(hashfn)
1

julia&gt; hashes = hashfn(randn(4));

julia&gt; typeof(hashes)
BitArray{1}

julia&gt; length(hashes)
1</code></pre><p>Since a single-bit hash doesn&#39;t do much to reduce the cost of similarity search, you usually want to generate multiple hash functions at once. For instance, in the snippet below we sample 10 hash functions, so that <code>hashfn(x)</code> is a length-10 <code>BitArray</code>:</p><pre><code class="language-julia-repl">julia&gt; hashfn = SimHash(10);

julia&gt; n_hashes(hashfn)
10

julia&gt; hashes = hashfn(randn(4));

julia&gt; length(hashes)
10</code></pre><p>The probability of a hash collision (for a single hash) is</p><p class="math-container">\[Pr[h(x) = h(y)] = 1 - \frac{\theta}{\pi}\]</p><p>where <span>$\theta = \text{arccos}(\text{cossim}(x,y))$</span> is the angle between <span>$x$</span> and <span>$y$</span>. This collision probability is shown in the plot below.</p><p><img src="../simhash_collision_probability.svg" alt="Probability of collision for SimHash"/></p><h3 id="Footnotes"><a class="docs-heading-anchor" href="#Footnotes">Footnotes</a><a id="Footnotes-1"></a><a class="docs-heading-anchor-permalink" href="#Footnotes" title="Permalink"></a></h3><section class="footnotes is-size-7"><ul><li class="footnote" id="footnote-1"><a class="tag is-link" href="#citeref-1">1</a><a href="#SimHash"><code>SimHash</code> API reference</a></li><li class="footnote" id="footnote-Charikar02"><a class="tag is-link" href="#citeref-Charikar02">Charikar02</a>Moses S. Charikar. <em>Similarity estimation techniques from rounding algorithms</em>. In Proceedings of the Thiry-Fourth Annual ACM Symposium on Theory of Computing, STOC &#39;02, page 380–388, New York, NY, USA, 2002. Association for Computing Machinery. 10.1145/509907.509965.</li></ul></section></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../../lshfunction_api/">« The LSHFunction API</a><a class="docs-footer-nextpage" href="../lp_distance/"><span>$\ell^p$</span> distance »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 26 February 2021 09:02">Friday 26 February 2021</span>. Using Julia version 1.5.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
